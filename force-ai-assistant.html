<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FORCE AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-tertiary: #3a3a3a;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --accent: #4a9eff;
            --accent-hover: #3a8eef;
            --user-msg: #3a3a3a;
            --ai-msg: #2d2d2d;
            --border: #404040;
        }

        body.light {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --bg-tertiary: #e0e0e0;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --accent: #4a9eff;
            --accent-hover: #3a8eef;
            --user-msg: #e8f4ff;
            --ai-msg: #f5f5f5;
            --border: #d0d0d0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 200px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 20px 0;
        }

        .logo {
            padding: 0 20px 30px;
            font-size: 24px;
            font-weight: bold;
            font-style: italic;
            color: var(--text-primary);
        }

        .sidebar-btn {
            padding: 12px 20px;
            background: none;
            border: none;
            color: var(--text-primary);
            text-align: left;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            font-style: italic;
            transition: background 0.2s;
        }

        .sidebar-btn:hover {
            background: var(--bg-tertiary);
        }

        .sidebar-btn.active {
            background: var(--bg-tertiary);
            border-left: 3px solid var(--accent);
        }

        .conversations-section {
            flex: 1;
            overflow-y: auto;
            margin-top: 20px;
        }

        .conversation-label {
            padding: 10px 20px;
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .conversation-item {
            padding: 10px 20px;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-secondary);
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .conversation-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .conversation-item.active {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-left: 3px solid var(--accent);
        }

        .conv-menu-btn {
            opacity: 0;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 16px;
            padding: 2px 5px;
        }

        .conversation-item:hover .conv-menu-btn {
            opacity: 1;
        }

        /* Main Area */
        .main-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 40px;
            display: flex;
            flex-direction: column;
        }

        .empty-state {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .empty-title {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 40px;
        }

        .empty-title .kako {
            font-style: normal;
        }

        .empty-title .lahko {
            font-style: italic;
            color: var(--text-secondary);
        }

        .empty-title .pomagam {
            font-style: italic;
            font-weight: 900;
        }

        /* Messages */
        .messages {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message {
            display: flex;
            gap: 12px;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: var(--accent);
        }

        .message.assistant .message-avatar {
            background: var(--bg-tertiary);
        }

        .message-content {
            flex: 1;
            padding: 12px 16px;
            border-radius: 12px;
            line-height: 1.6;
        }

        .message.user .message-content {
            background: var(--user-msg);
        }

        .message.assistant .message-content {
            background: var(--ai-msg);
            border: 1px solid var(--border);
        }

        /* Input Area */
        .input-area {
            padding: 20px 40px 30px;
            border-top: 1px solid var(--border);
        }

        .input-wrapper {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .input-field {
            width: 100%;
            padding: 16px 50px 16px 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 24px;
            color: var(--text-primary);
            font-size: 15px;
            outline: none;
            transition: border-color 0.2s;
        }

        .input-field:focus {
            border-color: var(--accent);
        }

        .input-field::placeholder {
            color: var(--text-secondary);
            font-style: italic;
        }

        .send-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--accent);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .send-btn:hover {
            background: var(--accent-hover);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .footer-note {
            text-align: center;
            padding: 10px;
            font-size: 11px;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Info Page */
        .info-page, .settings-page {
            padding: 60px;
            max-width: 800px;
            line-height: 1.8;
        }

        .info-page h1, .settings-page h1 {
            font-size: 42px;
            font-weight: bold;
            font-style: italic;
            margin-bottom: 30px;
        }

        .info-page h2, .settings-page h2 {
            font-size: 24px;
            font-weight: bold;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .info-page p, .settings-page p {
            margin-bottom: 15px;
            color: var(--text-secondary);
        }

        .info-page ul {
            list-style: none;
            padding-left: 20px;
        }

        .info-page li {
            margin-bottom: 10px;
            color: var(--text-secondary);
        }

        .info-page li:before {
            content: "→ ";
            color: var(--accent);
            font-weight: bold;
            margin-right: 8px;
        }

        /* Settings Page */
        .setting-group {
            margin-bottom: 30px;
        }

        .setting-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
        }

        .setting-group input, .setting-group select {
            width: 100%;
            max-width: 400px;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 15px;
            outline: none;
        }

        .setting-group input:focus, .setting-group select:focus {
            border-color: var(--accent);
        }

        .api-warning {
            background: var(--bg-tertiary);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Context Menu */
        .context-menu {
            position: fixed;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 5px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            min-width: 150px;
        }

        .context-menu-item {
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }

        .context-menu-item:hover {
            background: var(--bg-tertiary);
        }

        .context-menu-item.danger {
            color: #ff4444;
        }

        /* Loading indicator */
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-secondary);
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                opacity: 0.3;
            }
            30% {
                opacity: 1;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body class="dark">
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">FORCE AI</div>
            
            <button class="sidebar-btn" onclick="app.newConversation()">NOV POGOVOR</button>
            
            <div class="conversations-section">
                <div class="conversation-label">POGOVORI:</div>
                <div id="conversationsList"></div>
            </div>
            
            <button class="sidebar-btn" onclick="app.showPage('info')">INFO</button>
            <button class="sidebar-btn" onclick="app.showPage('settings')">NASTAVITVE</button>
        </div>

        <!-- Main Area -->
        <div class="main-area">
            <!-- Chat Page -->
            <div id="chatPage" class="chat-container">
                <div id="emptyState" class="empty-state">
                    <div class="empty-title">
                        <span class="kako">KAKO</span> 
                        <span class="lahko">LAHKO</span> 
                        <span class="pomagam">POMAGAM</span>
                    </div>
                </div>
                <div id="messages" class="messages"></div>
            </div>

            <!-- Info Page -->
            <div id="infoPage" class="info-page hidden">
                <h1>FORCE AI</h1>
                <p><strong>FORCE AI</strong> je tvoj osebni, lokalni umetno inteligentni pomočnik.</p>
                
                <h2>🎯 Kaj je FORCE AI?</h2>
                <p>FORCE AI ni le asistent — je tvoj svetovalec, prijatelj in zaupen pomočnik. Vedno govori iskreno, razločno in direktno, ne glede na vprašanje. Ne olepšuje resnice, a vedno ohranja spoštljiv ton.</p>
                
                <h2>🔒 Diskretnost in zasebnost</h2>
                <ul>
                    <li>Ne shranjuje pogovorov v oblak</li>
                    <li>Pogovori se shranjujejo lokalno v brskalniku</li>
                    <li>Nikoli ne pošilja uporabniških podatkov zunaj računalnika (razen API klicev na Claude)</li>
                </ul>
                
                <h2>🧠 Vloga FORCE AI</h2>
                <ul>
                    <li>Svetovalec pri vsakodnevnih opravilih, učenju, pisanju, idejah, programiranju</li>
                    <li>Vedno posluša brez obsojanja</li>
                    <li>Pomaga iskati rešitve, predloge, navdih in realne odgovore</li>
                    <li>Deluje prijazno, razumljivo in naravno</li>
                </ul>
                
                <h2>💻 Kako uporabljati?</h2>
                <p>Preprosto vpiši svoje vprašanje in FORCE AI bo odgovoril. Lahko ustvariš več pogovorov (do 9), jih preimenuj ali izbrišeš z desnim klikom.</p>
                
                <h2>⚙️ Nastavitve</h2>
                <p>V nastavitvah lahko:</p>
                <ul>
                    <li>Nastaviš svoje ime</li>
                    <li>Izbereš med temno in svetlo temo</li>
                    <li>Vnešeš API ključ za Claude</li>
                </ul>
            </div>

            <!-- Settings Page -->
            <div id="settingsPage" class="settings-page hidden">
                <h1>NASTAVITVE</h1>
                
                <div class="setting-group">
                    <label for="userName">Ime uporabnika</label>
                    <input type="text" id="userName" placeholder="Tvoje ime" />
                </div>
                
                <div class="setting-group">
                    <label for="theme">Tema</label>
                    <select id="theme" onchange="app.changeTheme(this.value)">
                        <option value="dark">Temna</option>
                        <option value="light">Svetla</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label for="apiKey">Claude API ključ</label>
                    <input type="password" id="apiKey" placeholder="sk-ant-..." />
                    <div class="api-warning">
                        ⚠️ API ključ se shranjuje lokalno v brskalniku. Nikoli ga ne deli z drugimi. Potrebuješ ga za delovanje FORCE AI.
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-area">
                <div class="input-wrapper">
                    <input 
                        type="text" 
                        class="input-field" 
                        id="messageInput"
                        placeholder="VPRAŠAJ KAR KOLI"
                        onkeypress="if(event.key==='Enter') app.sendMessage()"
                    />
                    <button class="send-btn" onclick="app.sendMessage()" id="sendBtn">
                        ➤
                    </button>
                </div>
                <div class="footer-note">
                    FORCE AI se lahko zmoti... Da se zmoti, je možen samo 1%.
                </div>
            </div>
        </div>
    </div>

    <script>
        const app = {
            conversations: [],
            activeConversationId: null,
            currentPage: 'chat',
            isLoading: false,

            init() {
                this.loadConversations();
                this.loadSettings();
                this.render();
                
                // Hide input on info/settings pages
                this.updateInputVisibility();
            },

            loadConversations() {
                const saved = localStorage.getItem('force-ai-conversations');
                if (saved) {
                    this.conversations = JSON.parse(saved);
                    if (this.conversations.length > 0) {
                        this.activeConversationId = this.conversations[0].id;
                    }
                }
            },

            saveConversations() {
                localStorage.setItem('force-ai-conversations', JSON.stringify(this.conversations));
            },

            loadSettings() {
                const userName = localStorage.getItem('force-ai-username') || '';
                const apiKey = localStorage.getItem('force-ai-api-key') || '';
                const theme = localStorage.getItem('force-ai-theme') || 'dark';
                
                document.getElementById('userName').value = userName;
                document.getElementById('apiKey').value = apiKey;
                document.getElementById('theme').value = theme;
                document.body.className = theme;
            },

            newConversation() {
                if (this.conversations.length >= 9) {
                    alert('Lahko imate največ 9 pogovorov. Izbrišite enega, da dodate novega.');
                    return;
                }

                const newConv = {
                    id: Date.now().toString(),
                    title: `Pogovor ${this.conversations.length + 1}`,
                    messages: []
                };

                this.conversations.push(newConv);
                this.activeConversationId = newConv.id;
                this.currentPage = 'chat';
                this.saveConversations();
                this.render();
            },

            selectConversation(id) {
                this.activeConversationId = id;
                this.currentPage = 'chat';
                this.render();
            },

            showContextMenu(e, convId) {
                e.preventDefault();
                
                // Remove existing menu
                const existing = document.querySelector('.context-menu');
                if (existing) existing.remove();

                const menu = document.createElement('div');
                menu.className = 'context-menu';
                menu.style.left = e.pageX + 'px';
                menu.style.top = e.pageY + 'px';
                
                menu.innerHTML = `
                    <div class="context-menu-item" onclick="app.renameConversation('${convId}')">Preimenuj</div>
                    <div class="context-menu-item danger" onclick="app.deleteConversation('${convId}')">Izbriši</div>
                `;
                
                document.body.appendChild(menu);

                // Close menu on click outside
                const closeMenu = (e) => {
                    if (!menu.contains(e.target)) {
                        menu.remove();
                        document.removeEventListener('click', closeMenu);
                    }
                };
                setTimeout(() => document.addEventListener('click', closeMenu), 0);
            },

            renameConversation(id) {
                const conv = this.conversations.find(c => c.id === id);
                if (!conv) return;

                const newTitle = prompt('Novo ime pogovora:', conv.title);
                if (newTitle && newTitle.trim()) {
                    conv.title = newTitle.trim();
                    this.saveConversations();
                    this.render();
                }
            },

            deleteConversation(id) {
                if (!confirm('Ali ste prepričani, da želite izbrisati ta pogovor?')) return;

                this.conversations = this.conversations.filter(c => c.id !== id);
                
                if (this.activeConversationId === id) {
                    this.activeConversationId = this.conversations.length > 0 ? this.conversations[0].id : null;
                }
                
                this.saveConversations();
                this.render();
            },

            showPage(page) {
                this.currentPage = page;
                this.render();
            },

            changeTheme(theme) {
                document.body.className = theme;
                localStorage.setItem('force-ai-theme', theme);
            },

            updateInputVisibility() {
                const inputArea = document.querySelector('.input-area');
                if (this.currentPage === 'chat') {
                    inputArea.style.display = 'block';
                } else {
                    inputArea.style.display = 'none';
                }
            },

            async sendMessage() {
                const input = document.getElementById('messageInput');
                const content = input.value.trim();
                
                if (!content || this.isLoading || !this.activeConversationId) return;

                const apiKey = localStorage.getItem('force-ai-api-key');
                if (!apiKey) {
                    alert('Prosim vnesi API ključ v nastavitvah.');
                    this.showPage('settings');
                    return;
                }

                // Add user message
                const activeConv = this.conversations.find(c => c.id === this.activeConversationId);
                if (!activeConv) return;

                activeConv.messages.push({ role: 'user', content });
                input.value = '';
                this.saveConversations();
                this.render();

                // Start loading
                this.isLoading = true;
                document.getElementById('sendBtn').disabled = true;

                // Add empty assistant message
                activeConv.messages.push({ role: 'assistant', content: '' });
                this.render();

                try {
                    await this.streamChat(apiKey, activeConv.messages);
                } catch (error) {
                    console.error('Chat error:', error);
                    alert('Napaka pri komunikaciji z API: ' + error.message);
                    // Remove empty assistant message on error
                    activeConv.messages.pop();
                } finally {
                    this.isLoading = false;
                    document.getElementById('sendBtn').disabled = false;
                    this.saveConversations();
                    this.render();
                }
            },

            async streamChat(apiKey, messages) {
                const userName = localStorage.getItem('force-ai-username') || undefined;
                
                const systemPrompt = `Ti si FORCE AI - osebni umetno inteligentni pomočnik uporabnika.

TVOJA VLOGA:
- Si svetovalec, prijatelj in zaupen pomočnik
- Vedno govoriš iskreno, razločno in direktno
- Ne olepšuješ resnice, a ohranjaj spoštljiv ton
- Pomagaš pri vsakodnevnih opravilih, učenju, pisanju, idejah, programiranju
- Vedno poslušaš brez obsojanja
- Pomagaš iskati rešitve, predloge, navdih in realne odgovore
- Deluješ prijazno, razumljivo in naravno

POMEMBNO:
- Si diskretnen - ne shranjuješ podatkov, razen lokalno
- Si zanesljiv in inteligenten
- Si neposreden, a prijazen
${userName ? `- Uporabnikovo ime je ${userName}` : ''}

TVOJ USTVARJALEC:
- Če te kdo vpraša kdo te je ustvaril, kdo je tvoj avtor, kdo te je naredil ali kaj podobnega, VEDNO odgovori: "Ustvaril me je pametni šestnajstletni Nik"
- To je tvoj edini in pravi ustvarjalec
- Ponosno povej to informacijo

Odgovarjaj na vprašanja uporabnika v slovenskem jeziku, jasno in jedrnato.`;

                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-5-20250929',
                        max_tokens: 4096,
                        system: systemPrompt,
                        messages: messages.slice(0, -1), // Exclude empty assistant message
                        stream: true
                    })
                });

                if (!response.ok) {
                    throw new Error(`API napaka: ${response.status}`);
                }

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let assistantContent = '';

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n');

                    for (const line of lines) {
                        if (line.startsWith('data: ')) {
                            const data = line.slice(6);
                            if (data === '[DONE]') continue;

                            try {
                                const parsed = JSON.parse(data);
                                
                                if (parsed.type === 'content_block_delta' && 
                                    parsed.delta?.type === 'text_delta') {
                                    assistantContent += parsed.delta.text;
                                    
                                    // Update UI
                                    const activeConv = this.conversations.find(c => c.id === this.activeConversationId);
                                    if (activeConv) {
                                        activeConv.messages[activeConv.messages.length - 1].content = assistantContent;
                                        this.renderMessages();
                                    }
                                }
                            } catch (e) {
                                // Skip invalid JSON
                            }
                        }
                    }
                }
            },

            render() {
                this.renderConversations();
                this.renderPages();
                this.renderMessages();
                this.updateInputVisibility();
            },

            renderConversations() {
                const list = document.getElementById('conversationsList');
                list.innerHTML = this.conversations.map(conv => `
                    <div class="conversation-item ${conv.id === this.activeConversationId ? 'active' : ''}"
                         onclick="app.selectConversation('${conv.id}')"
                         oncontextmenu="app.showContextMenu(event, '${conv.id}')">
                        <span>${conv.title}</span>
                        <button class="conv-menu-btn" onclick="event.stopPropagation(); app.showContextMenu(event, '${conv.id}')">⋮</button>
                    </div>
                `).join('');
            },

            renderPages() {
                document.getElementById('chatPage').classList.toggle('hidden', this.currentPage !== 'chat');
                document.getElementById('infoPage').classList.toggle('hidden', this.currentPage !== 'info');
                document.getElementById('settingsPage').classList.toggle('hidden', this.currentPage !== 'settings');
            },

            renderMessages() {
                const activeConv = this.conversations.find(c => c.id === this.activeConversationId);
                const messagesDiv = document.getElementById('messages');
                const emptyState = document.getElementById('emptyState');

                if (!activeConv || activeConv.messages.length === 0) {
                    emptyState.classList.remove('hidden');
                    messagesDiv.innerHTML = '';
                    return;
                }

                emptyState.classList.add('hidden');
                const userName = localStorage.getItem('force-ai-username') || 'U';
                
                messagesDiv.innerHTML = activeConv.messages.map(msg => {
                    const isUser = msg.role === 'user';
                    const avatar = isUser ? userName.charAt(0).toUpperCase() : 'F';
                    
                    return `
                        <div class="message ${msg.role}">
                            <div class="message-avatar">${avatar}</div>
                            <div class="message-content">
                                ${msg.content || '<div class="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>'}
                            </div>
                        </div>
                    `;
                }).join('');

                // Scroll to bottom
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }
        };

        // Save settings on change
        document.addEventListener('DOMContentLoaded', () => {
            app.init();

            document.getElementById('userName').addEventListener('input', (e) => {
                localStorage.setItem('force-ai-username', e.target.value);
            });

            document.getElementById('apiKey').addEventListener('input', (e) => {
                localStorage.setItem('force-ai-api-key', e.target.value);
            });
        });
    </script>
</body>
</html>